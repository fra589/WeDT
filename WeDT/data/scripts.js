var netDevURL="http://192.168.1.102",attenteOK=!1;async function index_onload(){get_networks()}function XMLHttpRequest_get(e){var t=new XMLHttpRequest;t.onreadystatechange=function(){t.readyState==4&&(t.status==200||t.status==0?XMLHttpResult(e,t.responseXML,t.responseText):alert("XMLHttpRequest_get("+e+") : Error "+t.status))},t.open("GET",e,!0),t.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),t.send()}function XMLHttpResult(e,t){t!=null&&(e=="/getnetworks"||e==netDevURL+"/getnetworks"?(setNetworkList(t),attenteOK=!0):e=="/wificonnect"&&(result=t.getElementsByTagName("result")[0].childNodes[0].nodeValue,alert(result=="OK"?"Connexion OK.":`Connexion error: 
`+result)))}async function get_networks(){var e,t,n=document.getElementById("networkTable");for(n.innerHTML="",e=document.getElementById("ssidActuel"),e.value="",t=document.getElementById("ipActuel"),t.value="",attenteOK=!1,XMLHttpRequest_get(location.protocol=="file:"?netDevURL+"/getnetworks":"/getnetworks");!attenteOK;)await sleep(100);attenteOK=!1}function sleep(e){return new Promise(t=>setTimeout(t,e))}function setNetworkList(e){var s,o,a,d,u,h,t="",c="",r=0,n="",l="",f="",i="",m=document.getElementById("networkTable");if(t+=`  <table class="netTables">
`,t+=`    <thead>
`,t+=`      <tr>
`,t+=`        <th>&nbsp;</th>
`,t+=`        <th>SSID</th>
`,t+=`        <th>Channel</th>
`,t+=`        <th>Security</th>
`,t+=`      </tr>
`,t+=`    </thead>
`,t+=`    <tbody>
`,a=e.getElementsByTagName("activeNetwork"),a.length==1&&(d=document.getElementById("ssidActuel"),currentSSID=a[0].getElementsByTagName("SSID")[0].childNodes[0].nodeValue,d.value=currentSSID,u=document.getElementById("ipActuel"),currentIP=a[0].getElementsByTagName("localip")[0].childNodes[0].nodeValue,u.value=currentIP),o=e.getElementsByTagName("network"),o.length>0)for(s=0;s<o.length;s++)c=o[s].getElementsByTagName("SSID")[0].textContent,r=o[s].getElementsByTagName("channel")[0].textContent,n=o[s].getElementsByTagName("RSSI")[0].textContent,l=o[s].getElementsByTagName("encryption")[0].textContent,n<=-90?i="images/signal0.svg":n>-90&&n<=-80?i="images/signal1.svg":n>-80&&n<=-70?i="images/signal2.svg":n>-70&&n<=-67?i="images/signal3.svg":n>-67&&(i="images/signal4.svg"),t+=`      <tr class="trlink" onclick="wifi_connect('`+c+"', '"+r+`')">
`,t+='        <td class="celluleCentree"><img src="'+i+'" title="RSSI = '+n+`" /></td>
`,t+="        <td>"+c+`</td>
`,t+="        <td>"+r+`</td>
`,t+="        <td>"+l+`</td>
`,t+=`      </tr>
`;else t+=`      <tr>
`,t+='        <td colspan="4">No network available</td>',t+=`      </tr>
`;t+=`    </tbody>
`,t+=`  </table>
`,m.innerHTML=t,h=document.getElementById("attente0"),h.classList.add("noshow")}async function wifi_connect(e,t){var i="",c=document.getElementById("ssid_input"),n=document.getElementById("pwd_input"),a=document.getElementById("attente0"),s=document.getElementById("btnConnect"),o=document.getElementById("btnAnnuler");const r=document.getElementById("btnShowCliPasswd");for(n=document.getElementById("pwd_input"),n.type!=="password"&&(n.type="password",r.src="images/oeuil.svg",r.title="Show password"),c.value=e+" (ch."+t+")",n.value="",connectOK=!0,suiteOK=!1,afficheDialog("dlgConnect"),s.disabled=!1,o.disabled=!1,n.focus();!suiteOK;)await sleep(100);suiteOK=!1,connectOK?(i=n.value,s.disabled=!0,o.disabled=!0,a.classList.remove("noshow"),XMLHttpRequest_post_wificonnect(e,i,t),setTimeout(function(){a.classList.add("noshow")},1e4),setTimeout(function(){closeDialog("dlgConnect")},1e4)):(closeDialog("dlgConnect"),s.disabled=!1,o.disabled=!1,n.value="")}function afficheDialog(e){var t=document.getElementById("dlgMask0"),n=document.getElementById(e);t.classList.remove("noshow"),window.setTimeout(function(){n.classList.remove("masquer")},.2)}function closeDialog(e){var t=document.getElementById("dlgMask0"),n=document.getElementById(e);n.classList.add("masquer"),window.setTimeout(function(){t.classList.add("noshow")},1)}function connect_clique(){connectOK=!0,suiteOK=!0,get_networks()}function connect_cancel(){connectOK=!1,suiteOK=!0}function connect_keyup(e){e.keyCode===13?document.getElementById("btnConnect").click():e.keyCode===27&&document.getElementById("btnAnnuler").click()}function XMLHttpRequest_post_wificonnect(e,t,n){var o,i,s=new XMLHttpRequest;s.onreadystatechange=function(){s.readyState==4&&(s.status==200||s.status==0?XMLHttpResult("/wificonnect",s.responseXML,s.responseText):alert("XMLHttpRequest_post_wificonnect() : Error "+s.status))},o=encodeURIComponent(e),i=encodeURIComponent(t),location.protocol=="file:"?s.open("POST",netDevURL+"/wificonnect",!0):s.open("POST","/wificonnect",!0),s.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),s.send("ssid="+o+"&pwd="+i+"&channel="+n)}function deconnect_clique(){var e="",e=`Do you really want to disconnect from the current network
and clear the client WiFi settings in the balance?`;confirm(e)&&XMLHttpRequest_get("deconnexion"),get_networks()}function toogleShowPasswd(e){if(e=="cli"){const e=document.getElementById("btnShowCliPasswd");var t=document.getElementById("pwd_input");t.type==="password"?(t.type="text",e.src="images/oeuil-barre.svg",e.title="Hide password"):(t.type="password",e.src="images/oeuil.svg",e.title="Show password")}}